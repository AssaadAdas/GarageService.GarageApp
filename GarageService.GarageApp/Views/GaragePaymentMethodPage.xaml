<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="GarageService.GarageApp.GaragePaymentMethodPage"
             xmlns:views="clr-namespace:GarageService.GarageApp.Views"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Style x:Key="ModernCardBorder" TargetType="Border">
                <Setter Property="Stroke" Value="{DynamicResource BorderColor}" />
                <Setter Property="StrokeThickness" Value="1" />
                <Setter Property="StrokeShape" Value="RoundRectangle 16" />
                <Setter Property="Padding" Value="20" />
                <Setter Property="BackgroundColor" Value="{DynamicResource SectionBackgroundColor}" />
                <Setter Property="Shadow">
                    <Setter.Value>
                        <Shadow Brush="{DynamicResource ShadowColor}"
                                Offset="0,4"
                                Radius="12"
                                Opacity="0.1"/>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="SectionHeader" TargetType="Label">
                <Setter Property="FontSize" Value="16" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{DynamicResource LabelTextColor}" />
                <Setter Property="Margin" Value="0,0,0,8" />
            </Style>

            <Style x:Key="ModernEntry" TargetType="Entry">
                <Setter Property="FontSize" Value="16" />
                <Setter Property="PlaceholderColor" Value="{DynamicResource SecondaryTextColor}" />
                <Setter Property="TextColor" Value="{DynamicResource LabelTextColor}" />
                <Setter Property="BackgroundColor" Value="Transparent" />
                <Setter Property="HeightRequest" Value="50" />
                <Setter Property="ClearButtonVisibility" Value="WhileEditing" />
            </Style>

            <Style x:Key="ModernPicker" TargetType="Picker">
                <Setter Property="FontSize" Value="16" />
                <Setter Property="TitleColor" Value="{DynamicResource SecondaryTextColor}" />
                <Setter Property="TextColor" Value="{DynamicResource LabelTextColor}" />
                <Setter Property="BackgroundColor" Value="Transparent" />
                <Setter Property="HeightRequest" Value="50" />
            </Style>

            <!-- Validation Error Style -->
            <Style x:Key="ErrorLabel" TargetType="Label">
                <Setter Property="FontSize" Value="12" />
                <Setter Property="TextColor" Value="Red" />
                <Setter Property="Margin" Value="5,0,0,0" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*,Auto" RowSpacing="0">
        <!-- Header -->
        <views:TitleView Title="Payment Method"
                         SubmitCommand="{Binding SaveCommand}"
                         BackCommand="{Binding GoBack}"
                         Grid.Row="0" />

        <ScrollView Grid.Row="1" 
                    Padding="0"
                    VerticalScrollBarVisibility="Never">
            <VerticalStackLayout Padding="20" Spacing="20">

                <!-- Welcome Section -->
                <VerticalStackLayout Spacing="8" HorizontalOptions="Center">
                    <Label Text="Add Payment Method" 
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="{DynamicResource LabelTextColor}"
                           HorizontalOptions="Center"/>

                    <Label Text="Secure and convenient payment options" 
                           FontSize="14"
                           TextColor="{AppThemeBinding Light={StaticResource SecondaryTextLight}, Dark={StaticResource SecondaryTextDark}}"
                           HorizontalOptions="Center"
                           HorizontalTextAlignment="Center"/>
                </VerticalStackLayout>

                <!-- Divider -->
                <BoxView HeightRequest="1" 
                         Color="{DynamicResource SeparatorColor}"
                         HorizontalOptions="Fill"
                         Margin="0,10"/>

                <!-- Payment Form Card -->
                <Border Style="{StaticResource ModernCardBorder}">
                    <VerticalStackLayout Spacing="20">

                        <!-- Card Number -->
                        <VerticalStackLayout Spacing="8">
                            <Label Text="Card Number" Style="{StaticResource SectionHeader}"/>
                            <Entry Placeholder="1234 5678 9012 3456" 
                                   Text="{Binding CardNumber}"
                                   Style="{StaticResource ModernEntry}"
                                   Keyboard="Numeric"
                                   MaxLength="19"/>
                        </VerticalStackLayout>

                        <!-- Card Holder Name -->
                        <VerticalStackLayout Spacing="8">
                            <Label Text="Cardholder Name" Style="{StaticResource SectionHeader}"/>
                            <Entry Placeholder="John Doe" 
                                   Text="{Binding CardHolderName}"
                                   Style="{StaticResource ModernEntry}"
                                   AutomationProperties.IsInAccessibleTree="True"
                                   MaxLength="50"/>
                        </VerticalStackLayout>

                        <!-- Expiry and CVV Row -->
                        <Grid ColumnDefinitions="2*,2*,*" ColumnSpacing="12">

                            <!-- Expiry Month -->
                            <VerticalStackLayout Grid.Column="0" Spacing="8">
                                <Picker 
                                        ItemsSource="{Binding Months}"
                                        SelectedItem="{Binding ExpiryMonth}"
                                        Style="{StaticResource ModernPicker}"/>
                            </VerticalStackLayout>

                            <!-- Expiry Year -->
                            <VerticalStackLayout Grid.Column="1" Spacing="8">
                                <Picker 
                                        ItemsSource="{Binding Years}"
                                        SelectedItem="{Binding ExpiryYear}"
                                        Style="{StaticResource ModernPicker}"/>
                            </VerticalStackLayout>

                            <!-- CVV -->
                            <VerticalStackLayout Grid.Column="2" Spacing="8">
                                <Entry Placeholder="123" 
                                       Text="{Binding Cvv}"
                                       Style="{StaticResource ModernEntry}"
                                       Keyboard="Numeric"
                                       MaxLength="4"
                                       IsPassword="True"/>
                            </VerticalStackLayout>
                        </Grid>

                        <!-- Payment Type -->
                        <VerticalStackLayout Spacing="8">
                            <Picker 
                                    ItemsSource="{Binding PaymentTypes}"
                                    ItemDisplayBinding="{Binding PaymentTypeDesc}"
                                    SelectedItem="{Binding SelectedPaymentType}"
                                    Style="{StaticResource ModernPicker}"/>
                        </VerticalStackLayout>
                        <!-- Remember Me & Forgot Password -->
                        <Grid ColumnDefinitions="*,*" RowDefinitions="auto">
                            <HorizontalStackLayout Spacing="10" Grid.Column="0">
                                <CheckBox IsChecked="{Binding IsPrimary}" 
                                          Color="#3498DB"/>
                                <Label Text="Primary" 
                                       VerticalOptions="Center"
                                       TextColor="#34495E"/>
                            </HorizontalStackLayout>
                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <!-- Security Notice -->
                <Frame Padding="15"
                       BackgroundColor="{AppThemeBinding Light=#E8F4FD, Dark=#1A5276}"
                       BorderColor="Transparent"
                       CornerRadius="12"
                       HasShadow="False">
                    <HorizontalStackLayout Spacing="12" VerticalOptions="Center">
                        <Label Text="ðŸ”’" FontSize="16" VerticalOptions="Center"/>
                        <Label Text="Your payment information is encrypted and secure"
                               FontSize="12"
                               TextColor="{AppThemeBinding Light=#0B4A6D, Dark=White}"
                               VerticalOptions="Center"
                               MaxLines="2"/>
                    </HorizontalStackLayout>
                </Frame>

            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>