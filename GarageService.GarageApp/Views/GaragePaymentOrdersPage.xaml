<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="GarageService.GarageApp.Views.GaragePaymentOrdersPage"
             xmlns:views="clr-namespace:GarageService.GarageApp.Views"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Style x:Key="PrimaryCardStyle" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=White, Dark=#2D2D2D}" />
                <Setter Property="CornerRadius" Value="16" />
                <Setter Property="Padding" Value="24" />
                <Setter Property="HasShadow" Value="True" />
                <Setter Property="Shadow" Value="{StaticResource ShadowMedium}" />
            </Style>

            <Style x:Key="PaymentCardStyle" TargetType="Frame">
                <Setter Property="CornerRadius" Value="12" />
                <Setter Property="Padding" Value="20" />
                <Setter Property="Margin" Value="0,0,0,12" />
                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=#F8FAFC, Dark=#3A3A3A}" />
                <Setter Property="HasShadow" Value="True" />
            </Style>

            <Style x:Key="TitleTextStyle" TargetType="Label">
                <Setter Property="FontSize" Value="20" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light=#1F2937, Dark=White}" />
                <Setter Property="VerticalOptions" Value="Center" />
            </Style>

            <Style x:Key="BodyTextStyle" TargetType="Label">
                <Setter Property="FontSize" Value="14" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light=#6B7280, Dark=#D1D5DB}" />
                <Setter Property="VerticalOptions" Value="Center" />
            </Style>

            <Style x:Key="FloatingActionButton" TargetType="Button">
                <Setter Property="CornerRadius" Value="16" />
                <Setter Property="HeightRequest" Value="48" />
                <Setter Property="WidthRequest" Value="48" />
                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=#2563EB, Dark=#1E40AF}" />
                <Setter Property="TextColor" Value="White" />
                <Setter Property="FontSize" Value="20" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="HorizontalOptions" Value="End" />
                <Setter Property="VerticalOptions" Value="Center" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*,Auto" RowSpacing="0">
        <!-- Header -->
        <views:TitleView Title="Order"
                         SubmitCommand="{Binding SaveCommand}"
                         BackCommand="{Binding GoBack}"
                         Grid.Row="0" />

        <!-- Main Content -->
        <ScrollView Grid.Row="1" 
                    Padding="0"
                    VerticalScrollBarVisibility="Never">
            <VerticalStackLayout Spacing="32" Padding="20,24,20,24">

                <!-- Premium Offer Card -->
                <Frame Style="{StaticResource PrimaryCardStyle}">
                    <VerticalStackLayout Spacing="16">
                        <Label Text="Premium Offer"
                               Style="{StaticResource TitleTextStyle}"
                               FontSize="18" />

                        <BoxView HeightRequest="1" 
                               BackgroundColor="{AppThemeBinding Light=#F3F4F6, Dark=#404040}" 
                               HorizontalOptions="Fill"/>

                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <VerticalStackLayout Grid.Column="0" Spacing="8">
                                <Label Text="{Binding PremiumOffer.PremiumDesc}"
                                       Style="{StaticResource TitleTextStyle}"
                                       FontSize="16"
                                       FontAttributes="None" />
                                <Label Text="Premium Service"
                                       Style="{StaticResource BodyTextStyle}"
                                       FontSize="12" />
                            </VerticalStackLayout>

                            <VerticalStackLayout Grid.Column="1" Spacing="4" HorizontalOptions="End">
                                <Label Text="{Binding PremiumOffer.PremiumCost, StringFormat='{0:C}'}"
                                       Style="{StaticResource TitleTextStyle}"
                                       FontSize="18"
                                       TextColor="{AppThemeBinding Light=#059669, Dark=#10B981}" />
                                <Label Text="{Binding PremiumOffer.Curr.CurrDesc}"
                                       Style="{StaticResource BodyTextStyle}"
                                       HorizontalOptions="End" />
                            </VerticalStackLayout>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <!-- Payment Methods Section -->
                <Frame Style="{StaticResource PrimaryCardStyle}">
                    <VerticalStackLayout Spacing="20">
                        <!-- Section Header -->
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="16">
                            <VerticalStackLayout Grid.Column="0" Spacing="4">
                                <Label Text="Payment Methods"
                                       Style="{StaticResource TitleTextStyle}" />
                                <Label Text="Select your preferred payment method"
                                       Style="{StaticResource BodyTextStyle}"
                                       FontSize="12" />
                            </VerticalStackLayout>

                            <Button Grid.Column="1"
                                    Text="+"
                                    Style="{StaticResource FloatingActionButton}"
                                    Command="{Binding AddPaymentMethodCommand}">
                                <Button.Shadow>
                                    <Shadow Brush="{AppThemeBinding Light=#2563EB, Dark=#1E40AF}"
                                            Offset="0,4"
                                            Opacity="0.3"
                                            Radius="8" />
                                </Button.Shadow>
                            </Button>
                        </Grid>

                        <BoxView HeightRequest="1" 
                               BackgroundColor="{AppThemeBinding Light=#F3F4F6, Dark=#404040}" 
                               HorizontalOptions="Fill"/>

                        <!-- Payment Methods List -->
                        <CollectionView ItemsSource="{Binding GaragePaymentMethod}"
                                     SelectionMode="Single"
                                     SelectedItem="{Binding SelectedPaymentMethod}">
                            <CollectionView.EmptyView>
                                <VerticalStackLayout HorizontalOptions="Center" 
                                                   VerticalOptions="Center" 
                                                   Spacing="16"
                                                   Padding="40">
                                    <Label Text="ðŸ’³"
                                           FontSize="48"
                                           HorizontalOptions="Center" />
                                    <Label Text="No Payment Methods"
                                           Style="{StaticResource TitleTextStyle}"
                                           HorizontalOptions="Center"
                                           HorizontalTextAlignment="Center" />
                                    <Label Text="Add a payment method to continue with your order"
                                           Style="{StaticResource BodyTextStyle}"
                                           HorizontalOptions="Center"
                                           HorizontalTextAlignment="Center" />
                                    <Button Text="Add Payment Method"
                                            Style="{StaticResource FloatingActionButton}"
                                            CornerRadius="24"
                                            HeightRequest="44"
                                            WidthRequest="200"
                                            Margin="0,8,0,0"
                                            Command="{Binding AddPaymentMethodCommand}" />
                                </VerticalStackLayout>
                            </CollectionView.EmptyView>

                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Frame Style="{StaticResource PaymentCardStyle}">
                                        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="16">
                                            <!-- Card Icon -->
                                            <Frame Grid.Column="0"
                                                   BackgroundColor="{AppThemeBinding Light=#EFF6FF, Dark=#1E3A8A}"
                                                   CornerRadius="10"
                                                   HeightRequest="44"
                                                   WidthRequest="44"
                                                   Padding="0"
                                                   HorizontalOptions="Center"
                                                   VerticalOptions="Center">
                                                <Label Text="ðŸ’³"
                                                       FontSize="16"
                                                       HorizontalOptions="Center"
                                                       VerticalOptions="Center" />
                                            </Frame>

                                            <!-- Card Details -->
                                            <VerticalStackLayout Grid.Column="1" Spacing="6">
                                                <Label Text="{Binding CardHolderName}"
                                                       Style="{StaticResource TitleTextStyle}"
                                                       FontSize="16"
                                                       FontAttributes="None" />
                                                <Label Text="{Binding CardNumber, StringFormat='**** **** **** {0}'}"
                                                       Style="{StaticResource BodyTextStyle}" />
                                            </VerticalStackLayout>

                                            <!-- Radio Button -->
                                            <Frame Grid.Column="2"
                                                   BackgroundColor="Transparent"
                                                   BorderColor="{AppThemeBinding Light=#D1D5DB, Dark=#6B7280}"
                                                   HasShadow="False"
                                                   CornerRadius="12"
                                                   HeightRequest="24"
                                                   WidthRequest="24"
                                                   Padding="0"
                                                   HorizontalOptions="Center"
                                                   VerticalOptions="Center">
                                                <Frame.Triggers>
                                                    <DataTrigger TargetType="Frame"
                                                                 Binding="{Binding IsSelected}"
                                                                 Value="True">
                                                        <Setter Property="BackgroundColor" 
                                                                Value="{AppThemeBinding Light=#2563EB, Dark=#3B82F6}" />
                                                        <Setter Property="BorderColor" 
                                                                Value="{AppThemeBinding Light=#2563EB, Dark=#3B82F6}" />
                                                    </DataTrigger>
                                                </Frame.Triggers>
                                                <RadioButton
                                                       Grid.Row="0" Grid.RowSpan="3" Grid.Column="1"
                                                       GroupName="PremiumOffersGroup"
                                                       IsChecked="{Binding Source={x:Reference PageRoot}, Path=BindingContext.SelectedPremiumOffer, Mode=TwoWay, Converter={StaticResource ReferenceEqualsConverter}, ConverterParameter={Binding .}}"
                                                       CheckedChanged="OnOfferCheckedChanged"
                                                       VerticalOptions="Center"
                                                       HeightRequest="32"
                                                       WidthRequest="32"/>
                                            </Frame>
                                        </Grid>

                                        <!-- Tap Gesture for Selection -->
                                        <Frame.GestureRecognizers>
                                            <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.SelectPaymentMethodCommand}"
                                                                  CommandParameter="{Binding .}" />
                                        </Frame.GestureRecognizers>
                                    </Frame>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Frame>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>