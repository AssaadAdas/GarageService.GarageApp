<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="GarageService.GarageApp.Views.PaymentMethodsPage"
             xmlns:views="clr-namespace:GarageService.GarageApp.Views"
             xmlns:viewmodel="clr-namespace:GarageService.GarageApp.ViewModels"
             >
    <ContentPage.Resources>
        <ResourceDictionary>
            <Style x:Key="PrimaryCardStyle" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=White, Dark=#2D2D2D}" />
                <Setter Property="CornerRadius" Value="16" />
                <Setter Property="Padding" Value="24" />
                <Setter Property="HasShadow" Value="True" />
                <Setter Property="Shadow" Value="{StaticResource ShadowMedium}" />
            </Style>

            <Style x:Key="PaymentCardStyle" TargetType="Frame">
                <Setter Property="CornerRadius" Value="12" />
                <Setter Property="Padding" Value="20" />
                <Setter Property="Margin" Value="0,0,0,12" />
                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=#F8FAFC, Dark=#3A3A3A}" />
                <Setter Property="HasShadow" Value="True" />
            </Style>

            <Style x:Key="TitleTextStyle" TargetType="Label">
                <Setter Property="FontSize" Value="20" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light=#1F2937, Dark=White}" />
                <Setter Property="VerticalOptions" Value="Center" />
            </Style>

            <Style x:Key="BodyTextStyle" TargetType="Label">
                <Setter Property="FontSize" Value="14" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light=#6B7280, Dark=#D1D5DB}" />
                <Setter Property="VerticalOptions" Value="Center" />
            </Style>

            <Style x:Key="FloatingActionButton" TargetType="Button">
                <Setter Property="CornerRadius" Value="16" />
                <Setter Property="HeightRequest" Value="48" />
                <Setter Property="WidthRequest" Value="48" />
                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=#2563EB, Dark=#1E40AF}" />
                <Setter Property="TextColor" Value="White" />
                <Setter Property="FontSize" Value="20" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="HorizontalOptions" Value="End" />
                <Setter Property="VerticalOptions" Value="Center" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*,Auto" RowSpacing="0">
        <!-- Header -->
        <views:TitleView Title="Payment Methods"
                    SubmitCommand="{Binding SaveCommand}"
                    BackCommand="{Binding GoBack}"
                    Grid.Row="0" />
        <ScrollView Grid.Row="1" 
               Padding="0"
               VerticalScrollBarVisibility="Never">
            <VerticalStackLayout Spacing="32" Padding="20,24,20,24">
                <!-- Payment Methods Section -->
                <Frame Style="{StaticResource PrimaryCardStyle}">
                    <VerticalStackLayout Spacing="20">
                        <!-- Section Header -->
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="16">
                            <VerticalStackLayout Grid.Column="0" Spacing="4">
                                <Label Text="Payment Methods"
                                  Style="{StaticResource TitleTextStyle}" />

                            </VerticalStackLayout>

                            <Button Grid.Column="1"
                               Text="+"
                               Style="{StaticResource FloatingActionButton}"
                               Command="{Binding AddPaymentMethodCommand}">
                                <Button.Shadow>
                                    <Shadow Brush="{AppThemeBinding Light=#2563EB, Dark=#1E40AF}"
                                       Offset="0,4"
                                       Opacity="0.3"
                                       Radius="8" />
                                </Button.Shadow>
                            </Button>
                        </Grid>

                        <BoxView HeightRequest="1" 
                          BackgroundColor="{AppThemeBinding Light=#F3F4F6, Dark=#404040}" 
                          HorizontalOptions="Fill"/>

                        <!-- Payment Methods List -->
                        <CollectionView ItemsSource="{Binding GaragePaymentMethod}"
                                SelectionMode="None"
                                >
                            <CollectionView.EmptyView>
                                <VerticalStackLayout HorizontalOptions="Center" 
                                              VerticalOptions="Center" 
                                              Spacing="16"
                                              Padding="40">
                                    <Label Text="ðŸ’³"
                                      FontSize="48"
                                      HorizontalOptions="Center" />
                                    <Label Text="No Payment Methods"
                                      Style="{StaticResource TitleTextStyle}"
                                      HorizontalOptions="Center"
                                      HorizontalTextAlignment="Center" />
                                    <Label Text="Add a payment method to continue with your order"
                                      Style="{StaticResource BodyTextStyle}"
                                      HorizontalOptions="Center"
                                      HorizontalTextAlignment="Center" />

                                </VerticalStackLayout>
                            </CollectionView.EmptyView>

                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Frame Style="{StaticResource PaymentCardStyle}">
                                        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="16">
                                            <!-- Card Icon -->
                                            <Frame Grid.Column="0"
                                              BackgroundColor="{AppThemeBinding Light=#EFF6FF, Dark=#1E3A8A}"
                                              CornerRadius="10"
                                              HeightRequest="44"
                                              WidthRequest="44"
                                              Padding="0"
                                              HorizontalOptions="Center"
                                              VerticalOptions="Center">
                                                <Label Text="ðŸ’³"
                                                  FontSize="16"
                                                  HorizontalOptions="Center"
                                                  VerticalOptions="Center" />
                                            </Frame>

                                            <!-- Card Details -->
                                            <VerticalStackLayout Grid.Column="1" Spacing="6">
                                                <Label Text="{Binding CardHolderName}"
                                                  Style="{StaticResource TitleTextStyle}"
                                                  FontSize="16"
                                                  FontAttributes="None" />
                                                <Label Text="{Binding CardNumber, StringFormat='**** **** **** {0}'}"
                                                  Style="{StaticResource BodyTextStyle}" />
                                            </VerticalStackLayout>

                                            <HorizontalStackLayout Grid.Column="1" 
                                                               VerticalOptions="Center"
                                                               HorizontalOptions="End"
                                                               Spacing="12">
                                                <!-- Reduced spacing between buttons -->
                                                <Button Text="âœï¸"
                                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:PaymentMethodsViewModel}}, Path=EditPaymentMethodCommand}" 
                                                    CommandParameter="{Binding .}"
                                                    BackgroundColor="Transparent"
                                                    TextColor="{AppThemeBinding Light=#1976D2, Dark=#90CAF9}"
                                                    FontSize="16"
                                                    Padding="0"
                                                    HeightRequest="36"
                                                    WidthRequest="36"
                                                    CornerRadius="18"/>
                                            </HorizontalStackLayout>
                                        </Grid>

                                        <!-- Tap Gesture for Selection -->
                                        <Frame.GestureRecognizers>
                                            <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.SelectPaymentMethodCommand}"
                                                             CommandParameter="{Binding .}" />
                                        </Frame.GestureRecognizers>
                                    </Frame>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Frame>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>